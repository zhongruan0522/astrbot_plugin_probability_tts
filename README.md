# 概率语音插件

基于AstrBot的概率语音转换插件，支持TTS语音合成、智能分段和内容过滤。

## 功能特性

1. **语音合成**: 使用OpenAI兼容的TTS API生成语音
2. **概率发送**: 根据设置的概率发送语音或文本消息
3. **智能分段**: 自动按句子分割内容，括号内容保持为文本
4. **思考过滤**: 自动过滤大模型的思考链内容
5. **灵活配置**: 支持动态切换音色和开关功能

## 安装方法

1. 将 `probability_voice` 文件夹复制到 AstrBot 的插件目录
2. 在WebUI中启用插件
3. 配置插件参数

## 配置说明

### 基础配置
- **model_name**: TTS模型名称（默认: tts-1）
- **api_key**: TTS服务的API密钥
- **voice_id**: 音色ID（默认: alloy）
- **probability_percentage**: 语音发送概率（0-100，默认: 90）
- **probability_total**: 概率总数（默认: 10）
- **tts_enabled**: TTS总开关（默认: 开启）

### 概率计算说明
当设置概率百分比为90%，概率总数为10时：
- 每连续10条消息中，前9条会发送语音
- 第10条会发送纯文本
- 然后循环往复

## 使用指令

### 切换音色
```
/ttsid <音色ID>
```
示例：`/ttsid nova`

### 开关TTS功能
```
/ttsswitch on/off
```
或使用中文：
```
/ttsswitch 开启/关闭
```

## 处理流程

1. 接收消息
2. 过滤 `<thinking>` 标签内的思考内容
3. 根据概率决定是否发送语音
4. 智能分段处理：
   - 句子结束符（。！？.!?）分割
   - 括号内容保持为文本
5. 按顺序发送语音或文本消息

## 示例

输入文本：
```
你好呀~你今天过的怎么样（探头）要抱抱
```

处理结果：
- 语音消息：你好呀~
- 语音消息：你今天过的怎么样
- 文本消息：（探头）
- 语音消息：要抱抱

## 注意事项

1. 请确保正确配置API密钥
2. 语音文件会保存在 `data/probability_voice` 目录
3. 插件会自动处理消息计数，无需手动干预
4. 支持中英文混合内容处理